function y = getapplytoGRoverlapp_ncon(AR, G, L, N, d, p, g, yg)
    if N == 1
        y = zeros(d,d);
    elseif N == 2
        ARc = conj(AR);
        y = ncon({G,L,AR,AR,AR,ARc,ARc,ARc},{[6 2 -7 3],[13 14],[14 -11 10],[10 6 5],[5 2 1],[13 -12 9],[9 -8 4],[4 3 1]},[1 2 3 4 5 6 9 10 13 14],[-12 -8 -11 -7]);
        y = y - g*yg;
        y = exp(1i*p)*y;
    elseif N == 3
        ARc = conj(AR);
        y = exp(1i*p)*ncon({G,L,AR,AR,AR,AR,ARc,ARc,ARc,ARc},{[11 6 2 -12 -7 3],[18 19],[19 -16 15],[15 11 9],[9 6 5],[5 2 1],[18 -17 14],[14 -13 10],[10 -8 4],[4 3 1]},[1 2 3 4 5 6 9 10 11 14 15 18 19],[-17 -13 -8 -16 -12 -7]);
        y = y - (exp(1i*p)*g)*yg;
        y = y + exp(2*1i*p)*ncon({G,L,AR,AR,AR,AR,AR,ARc,ARc,ARc,ARc,ARc},{[11 6 2 -10 7 3],[21 22],[22 -20 17],[17 -16 13],[13 11 12],[12 6 5],[5 2 1],[21 -19 18],[18 -15 14],[14 -9 8],[8 7 4],[4 3 1]},[1 2 3 4 5 6 7 8 12 11 13 14 17 18 21 22],[-19 -15 -9 -20 -16 -10]);
        y = y - (exp(2*1i*p)*g)*yg;
    elseif N == 4
        ARc = conj(AR);
        y = exp(1i*p)*ncon({G,L,AR,AR,AR,AR,AR,ARc,ARc,ARc,ARc,ARc},{[16 11 6 2 -17 -12 -7 3],[23 24],[24 -21 20],[20 16 15],[15 11 10],[10 6 4],[4 2 1],[23 -22 19],[19 -18 14],[14 -13 9],[9 -8 5],[5 3 1]},[1 2 3 4 5 6 9 10 11 14 15 16 19 20 23 24],[-22 -18 -13 -8 -21 -17 -12 -7]);
        y = y - (exp(1i*p)*g)*yg;
        y = y + exp(2*1i*p)*ncon({G,L,AR,AR,AR,AR,AR,AR,ARc,ARc,ARc,ARc,ARc,ARc},{[15 10 6 2 -16 -11 7 3],[26 27],[27 -24 23],[23 -20 19],[19 15 14],[14 10 9],[9 6 4],[4 2 1],[26 -25 22],[22 -21 18],[18 -17 13],[13 -12 8],[8 7 5],[5 3 1]},[1 2 3 4 5 6 7 8 9 10 13 14 15 18 19 22 23 26 27],[-25 -21 -17 -12 -24 -20 -16 -11]);
        y = y - (exp(2*1i*p)*g)*yg;
        y = y + exp(3*1i*p)*ncon({G,L,AR,AR,AR,AR,AR,AR,AR,ARc,ARc,ARc,ARc,ARc,ARc,ARc},{[14 10 6 2 -15 11 7 3],[29 30],[30 -27 26],[26 -23 22],[22 -19 18],[18 14 13],[13 10 9],[9 6 4],[4 2 1],[29 -28 25],[25 -24 21],[21 -20 17],[17 -16 12],[12 11 8],[8 7 5],[5 3 1]},[1 2 3 4 5 6 7 8 9 10 11 12 13 14 17 18 21 22 25 26 29 30],[-28 -24 -20 -16 -27 -23 -19 -15]);
        y = y - (exp(3*1i*p)*g)*yg;
    end    
end
