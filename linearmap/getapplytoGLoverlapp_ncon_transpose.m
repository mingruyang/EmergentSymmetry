function y = getapplytoGLoverlapp_ncon_transpose(AL, G, R, N, d, p, g, yg)
    if N == 1
        y = zeros(d,d);
    elseif N == 2
        ALc = conj(AL);
        y = ncon({G,R,AL,AL,AL,ALc,ALc,ALc},{[-7 11 8 12],[13 14],[1 -2 5],[5 -6 9],[9 11 13],[1 -3 4],[4 8 10],[10 12 14]},[1 4 5 8 9 10 11 12 13 14],[-3 -7 -2 -6]);
        y = y - g*yg;
        y = exp(-1i*p)*y;
    elseif N == 3
        ALc = conj(AL);
        y = exp(-1i*p)*ncon({G,R,AL,AL,AL,AL,ALc,ALc,ALc,ALc},{[-7 -12 16 8 13 17],[18 19],[1 -2 5],[5 -6 9],[9 -11 15],[15 16 18],[1 -3 4],[4 8 10],[10 13 14],[14 17 19]},[19 18 17 16 15 14 13 10 9 8 5 4 1],[-3 -7 -12 -2 -6 -11]);
        y = y - (exp(-1i*p)*g)*yg;
        y = y + exp(-2*1i*p)*ncon({G,R,AL,AL,AL,AL,AL,ALc,ALc,ALc,ALc,ALc},{[-10 16 20 9 15 19],[21 22],[1 -2 5],[5 -6 12],[12 -11 13],[13 16 17],[17 20 21],[1 -3 4],[4 -7 8],[8 9 14],[14 15 18],[18 19 22]},[22 21 20 19 18 17 16 15 14 13 9 8 12 5 4 1],[-3 -7 -10 -2 -6 -11]);
        y = y - (exp(-2*1i*p)*g)*yg;
    elseif N == 4
        ALc = conj(AL);
        y = exp(-1i*p)*ncon({G,R,AL,AL,AL,AL,AL,ALc,ALc,ALc,ALc,ALc},{[-7 -12 -17 21 8 13 18 22],[23 24],[1 -2 4],[4 -6 10],[10 -11 15],[15 -16 20],[20 21 23],[1 -3 5],[5 8 9],[9 13 14],[14 18 19],[19 22 24]},[24 23 22 21 20 19 18 15 14 13 10 9 8 5 4 1],[-3 -7 -12 -17 -2 -6 -11 -16]);
        y = y - (exp(-1i*p)*g)*yg;
        y = y + exp(-2*1i*p)*ncon({G,R,AL,AL,AL,AL,AL,AL,ALc,ALc,ALc,ALc,ALc,ALc},{[-11 -16 20 24 12 17 21 25],[26 27],[1 -2 4],[4 -6 9],[9 -10 14],[14 -15 19],[19 20 23],[23 24 26],[1 -3 5],[5 -7 8],[8 12 13],[13 17 18],[18 21 22],[22 25 27]},[27 26 25 24 23 22 21 20 19 18 17 14 13 12 9 8 5 4 1],[-3 -7 -11 -16 -2 -6 -10 -15]);
        y = y - (exp(-2*1i*p)*g)*yg;
        y = y + exp(-3*1i*p)*ncon({G,R,AL,AL,AL,AL,AL,AL,AL,ALc,ALc,ALc,ALc,ALc,ALc,ALc},{[-15 19 23 27 16 20 24 28],[29 30],[1 -2 4],[4 -6 9],[9 -10 13],[13 -14 18],[18 19 22],[22 23 26],[26 27 29],[1 -3 5],[5 -7 8],[8 -11 12],[12 16 17],[17 20 21],[21 24 25],[25 28 30]},[30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 13 12 9 8 5 4 1],[-3 -7 -11 -15 -2 -6 -10 -14]);
        y = y - (exp(-3*1i*p)*g)*yg;
    end    
end
